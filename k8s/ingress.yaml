apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: voting-platform-ingress
  namespace: production # Change namespace based on environment (e.g., dev, staging, prod)
  annotations:
    kubernetes.io/ingress.class: "nginx" # Specifies the ingress controller (e.g., nginx)
    nginx.ingress.kubernetes.io/ssl-redirect: "true" # Redirect HTTP traffic to HTTPS
    nginx.ingress.kubernetes.io/proxy-body-size: "10m" # Maximum request body size
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60" # Timeout for reading a response from the backend
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60" # Timeout for sending a request to the backend
    nginx.ingress.kubernetes.io/server-snippet: |
      # Additional security headers
      add_header X-Content-Type-Options nosniff;
      add_header X-XSS-Protection "1; mode=block";
      add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
spec:
  tls:
    - hosts:
        - api.voting-platform.com # Replace with your domain name
      secretName: voting-platform-tls-secret # Kubernetes secret for TLS termination
  rules:
    - host: api.voting-platform.com # Replace with your domain name
      http:
        paths:
          - path: /api/v1 # Path for API routing
            pathType: Prefix # Matches all paths starting with /api/v1
            backend:
              service:
                name: voting-platform-service # Name of the Kubernetes service
                port:
                  number: 8080 # Port exposed by the service
          - path: /health # Health check endpoint
            pathType: Prefix
            backend:
              service:
                name: voting-platform-health-service # Separate service for health checks
                port:
                  number: 8080
  # Resource limits for ingress controller (example for production environment)
  resources:
    limits:
      cpu: "500m" # CPU limit for ingress controller
      memory: "256Mi" # Memory limit for ingress controller
    requests:
      cpu: "250m" # CPU request for ingress controller
      memory: "128Mi" # Memory request for ingress controller